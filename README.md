# juvenal-lib: The universal election verifier library

[![License](https://img.shields.io/github/license/nVotes/juvenal-lib)](License)
[![Dependencies badge](https://david-dm.org/nVotes/juvenal-lib.svg)](https://david-dm.org/nVotes/juvenal-lib)
[![Build](https://github.com/nVotes/juvenal-lib/workflows/build/badge.svg?branch=master)](https://github.com/nVotes/juvenal-lib/actions?query=workflow%3Abuild)
[![Coverage status](https://img.shields.io/codecov/c/github/nVotes/juvenal-lib)](https://codecov.io/gh/nVotes/juvenal-lib/)
[![Community chat](https://img.shields.io/discord/651538033291690014)](https://discord.gg/dfdnFWJ)

- API Documentation: [https://nvotes.github.io/juvenal-lib]
- Web interface repo: [https://github.com/nvotes/juvenal]
- Web interface demo: [https://nvotes.github.io/juvenal]

**juvenal-lib** is a library that implements an universal election verifier. It enables the verification of election ballots, tallies, and proofs generated by multiple voting solutions. It has been developed independently by the [nVotes] Online Voting team and is written in TypeScript. It also includes a command line verifier.

It currently only supports verifying [ElectionGuard]. Work for supporting [Helios Voting] is in the works.  This library is used by [Juvenal], which is an open-source and web-based universal verifier. 

**WARNING**: This software is in development and is incomplete and most probably
contains bugs. Please do not use in production.

## Building

This is a TypeScript project and uses the standard TypeScript toolchain.
Install dependencies with:

```bash
yarn
```

Then you can build the project into javascript to the `build/` directory with:

```bash
yarn build
```

You can execute the unit tests with:

```bash
yarn test
```

You can generate package documentation with:

```bash
yarn doc
```

## Running

You can run the verifier through the command line using `node`:

```bash
node build/src/bin/verifier.js $PATH_TO_ELECTION_RECORD.json
```

There are multiple election record examples in the directory `test/data` that
you can use with the verifier. For example, the following command should verify
correctly the `valid_encrypted.json` election record, which contains a valid
election record:

```bash
node build/src/bin/verifier.js tests/data/valid_encrypted.json
```

## Contribute

There are multiple ways to contribute:

- [Submit bugs] and help us verify fixes as they are checked in.
- Create [Pull Requests] implementing new features.
- Create [Pull Requests] implementing proofs verification for a verifiable voting system not yet supported.
- Review [source code changes].
- Use the [discord channel] to engage with the community.

## Development

Note that we autogenerate both:

- The file `json_schemas.ts` (in directory `vendor/electionguard-schema-0.85`)
  that contains the schemas as an object, so that they can be directly loaded
  as a javascript dependency and not opening json files.
- The schema definitions in directory `vendor/electionguard-schema-0.85/@types`,
  so that the election record to be verified can be loaded from json in a typed
  manner.

When required, you can update the two generated json schemas derivatives
mentioned above by running:

```bash
yarn generate_election_record_types
```

## Dependencies

The verifier uses minimal runtime dependencies to be very self-contained:

- [verificatum-vjsc]: Self-contained javascript cryptographic library for use
  in electronic voting clients. Developed and maintained by Douglas Wikstr√∂m
  and part of the [Verificatum project]. It's directly included in the
  `vendors` directory.
- [ajv]: A JSON Schema draft-07 validator, as the verifiable data is in JSON
  and the [ElectionGuard Specification] includes the
  [JSON Schema of the election record]. We have directly extracted and copied
  verbatim these schemas in the `vendors` directory.
- [@types/node] The definitions for node.js, required to process command-line
  arguments in the command-line verifier.

There is a bunch of other development-only additional dependencies. These are
not really relevant other than for development purposes:

- [jest]: TypeScript-friendy testing framework.
- [typedoc]: Generates package documentation.
- [json-schema-to-TypeScript]: Compile json schema to TypeScript typings.
- [eslint]: A linting library.
- [@TypeScript-eslint/parser]: A parser that allows ESLint to lint TypeScript code.
- [@TypeScript-eslint/eslint-plugin]: A plugin that contains some ESLint rules that are TypeScript specific.
- [prettier]: The core prettier library.
- [eslint-config-prettier]: Disables ESLint rules that might conflict with prettier.
- [eslint-plugin-prettier]: Runs prettier as an ESLint rule.
- [link-staged]: Allows to run linting commands on files that are staged to be committed.
- [husky]: Makes git hooks simpler to use.

[nVotes]: https://nvotes.com
[Juvenal]: https://github.com/nvotes/juvenal
[ElectionGuard]: https://github.com/microsoft/electionguard
[ElectionGuard specification]: https://raw.githubusercontent.com/microsoft/ElectionGuard-SDK-Specification/b2c767ae9fed05be36accad04b5bc6b3512be5ad/Informal/ElectionGuardSpecificationV0.85.pdf
[jsonschema published in the formal specification]: https://github.com/microsoft/ElectionGuard-SDK-Specification/tree/781c38ec95416842d68a0adfceb5be63845497e8/Formal/schema/schemas
[verificatum-vjsc]: https://github.com/verificatum/verificatum-vjsc/
[verificatum project]: https://verificatum.org
[ajv]: https://www.npmjs.com/package/ajv
[json schema of the election record]: https://github.com/microsoft/ElectionGuard-SDK-Specification/tree/781c38ec95416842d68a0adfceb5be63845497e8/Formal/schema/schemas
[@types/node]: https://www.npmjs.com/package/@types/node
[jest]: https://jestjs.io/
[typedoc]: https://github.com/TypeStrong/typedoc
[submit bugs]: https://github.com/nVotes/juvenal-lib/issues
[source code changes]: https://github.com/nVotes/juvenal-lib/pulls
[json-schema-to-TypeScript]: https://www.npmjs.com/package/json-schema-to-TypeScript
[coveralls]: https://www.npmjs.com/package/coveralls
[eslint]: https://www.npmjs.com/package/eslint
[@TypeScript-eslint/parser]: https://www.npmjs.com/package/@TypeScript-eslint/parser
[@TypeScript-eslint/eslint-plugin]: https://www.npmjs.com/package/@TypeScript-eslint/eslint-plugin
[prettier]: https://www.npmjs.com/package/prettier
[eslint-config-prettier]: https://www.npmjs.com/package/eslint-config-prettier
[eslint-plugin-prettier]: https://www.npmjs.com/package/eslint-plugin-prettier
[link-staged]: https://www.npmjs.com/package/link-staged
[husky]: https://www.npmjs.com/package/husky
[Helios Voting]: https://heliosvoting.org/
[discord channel]: https://discord.gg/dfdnFWJ
[Pull Requests]: https://github.com/nVotes/juvenal-lib/pulls
[https://nvotes.github.io/juvenal-lib]: https://nvotes.github.io/juvenal-lib
[https://github.com/nvotes/juvenal]: https://github.com/nvotes/juvenal
[https://nvotes.github.io/juvenal]: https://nvotes.github.io/juvenal/